<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Client Login</title>
		<link rel="stylesheet" href="./www/global.css" />
		<script type="module">
			import { GetWebCode, CallRESTAPI } from "./www/utils.js";

			document.addEventListener("DOMContentLoaded", function () {
				const loginForm = document.getElementById("login-form");
				const errorMessageDiv = document.getElementById("errormessage");

				loginForm.addEventListener("submit", async function (event) {
					event.preventDefault(); // Prevent the default form submission

					// Clear previous error message
					errorMessageDiv.textContent = "";

					// Get form values
					const username = document.getElementById("username").value;
					const email = document.getElementById("email").value;
					const password = document.getElementById("password").value;

					const webcode = await GetWebCode(`${username}:${email}:${password}`);

					// Prepare data to send
					const requestData = {
						AccountName: username,
						WebCode: webcode,
					};

					try {
						// Call the REST API
						const response = await CallRESTAPI(
							"./webClientLoginAllowed",
							"POST",
							requestData,
							loginOkay,
							loginFailed,
							loginError,
						);

						function loginOkay(data) {
							// For now just add a login success message
							errorMessageDiv.style.color = "green";
							errorMessageDiv.textContent = "Login successful!";
						}
						function loginFailed(data) {
							// Display error message from server
							errorMessageDiv.textContent =
								data.message || "Login failed. Please try again.";
						}
						function loginError(err) {
							// Display generic error message
							errorMessageDiv.textContent =
								"An error occurred. Please try again later.";
						}
					} catch (error) {
						errorMessageDiv.textContent =
							"An error occurred. Please try again later.";
					}
				});
			});
		</script>
	</head>
	<body>
		<div id="login-container">
			<h1>Data Generator</h1>
			<h2>Client Login</h2>
			<form id="login-form" action="/clientlogin" method="post">
				<label for="username">Account name:</label>
				<input type="text" id="username" name="username" required />
				<label for="email">Account email:</label>
				<input type="email" id="email" name="email" required />
				<label for="password">Password:</label>
				<input type="password" id="password" name="password" required />
				<input type="submit" value="Login" />
				<div id="errormessage"></div>
			</form>
		</div>
	</body>
</html>
